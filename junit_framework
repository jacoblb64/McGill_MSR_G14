# mining how many projects use junit
JUNIT: output sum of int;

junit := false;

visit(input, visitor {
    after node: Project ->
        if (junit)
            JUNIT << 1;
  # only look at the latest snapshot of Java files
  before n: CodeRepository -> {
    snapshot := getsnapshot(n, "SOURCE_JAVA_JLS");
    foreach (i: int; def(snapshot[i]))
      visit(snapshot[i]);
    stop;
  }
  # look for imports
  before node: ASTRoot ->
      exists(j: int; match("^org\\.junit\\.", node.imports[j])) {
      junit = true;
      stop;
      }
  # look for FQN
  before node: Type ->
      if (match("^org\\.junit\\.", node.name)) {
      junit = true;
      stop;
      }
});